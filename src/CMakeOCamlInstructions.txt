if(LIBFACILE_FOUND)
link_directories (${OCAMLC_DIR})
#create depend file need to generate .o file
add_custom_command(OUTPUT ${CMAKE_CURRENT_SOURCE_DIR}/solver/.depend
                   COMMAND ${OCAMLDEP_EXECUTABLE}  ARGS -I +facile ${CMAKE_CURRENT_SOURCE_DIR}/solver/*.mli ${CMAKE_CURRENT_SOURCE_DIR}/solver/*.ml > ${CMAKE_CURRENT_SOURCE_DIR}/solver/.depend
                   WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/solver)

add_custom_command(OUTPUT ${CMAKE_CURRENT_SOURCE_DIR}/solver/chemset.cmi
                   COMMAND ${OCAMLC_EXECUTABLE}  ARGS -I +facile -c ${CMAKE_CURRENT_SOURCE_DIR}/solver/chemset.mli
                   DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/solver/calc.mli ${CMAKE_CURRENT_SOURCE_DIR}/solver/.depend
                   WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/solver/)

add_custom_command(OUTPUT ${CMAKE_CURRENT_SOURCE_DIR}/solver/chemset.cmx
                   COMMAND ${OCAMLOPT_EXECUTABLE}  ARGS -I +facile -c ${CMAKE_CURRENT_SOURCE_DIR}/solver/chemset.ml
                   DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/solver/chemset.cmi ${CMAKE_CURRENT_SOURCE_DIR}/solver/.depend
                   WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/solver/)

add_custom_command(OUTPUT ${CMAKE_CURRENT_SOURCE_DIR}/solver/datastruct.cmi
                   COMMAND ${OCAMLC_EXECUTABLE}  ARGS -I +facile -c ${CMAKE_CURRENT_SOURCE_DIR}/solver/datastruct.mli
                   DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/solver/datastruct.mli ${CMAKE_CURRENT_SOURCE_DIR}/solver/.depend
                   WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/solver/)

add_custom_command(OUTPUT ${CMAKE_CURRENT_SOURCE_DIR}/solver/datastruct.cmx
                   COMMAND ${OCAMLOPT_EXECUTABLE}  ARGS -I +facile -c ${CMAKE_CURRENT_SOURCE_DIR}/solver/datastruct.ml
                   DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/solver/datastruct.cmi ${CMAKE_CURRENT_SOURCE_DIR}/solver/chemset.cmx ${CMAKE_CURRENT_SOURCE_DIR}/solver/.depend
                   WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/solver/)


add_custom_command(OUTPUT ${CMAKE_CURRENT_SOURCE_DIR}/solver/chem.cmi
                   COMMAND ${OCAMLC_EXECUTABLE}  ARGS -I +facile -c ${CMAKE_CURRENT_SOURCE_DIR}/solver/chem.mli
                   DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/solver/chem.mli ${CMAKE_CURRENT_SOURCE_DIR}/solver/.depend
                   WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/solver/)

add_custom_command(OUTPUT ${CMAKE_CURRENT_SOURCE_DIR}/solver/chem.cmx
                   COMMAND ${OCAMLOPT_EXECUTABLE}  ARGS -I +facile -c ${CMAKE_CURRENT_SOURCE_DIR}/solver/chem.ml
                   DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/solver/chem.cmi ${CMAKE_CURRENT_SOURCE_DIR}/solver/chemset.cmx ${CMAKE_CURRENT_SOURCE_DIR}/solver/.depend
                   WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/solver/)


add_custom_command(OUTPUT ${CMAKE_CURRENT_SOURCE_DIR}/solver/parser.cmi
                   COMMAND ${OCAMLC_EXECUTABLE}  ARGS -I +facile -c ${CMAKE_CURRENT_SOURCE_DIR}/solver/parser.mli
                   DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/solver/parser.mli ${CMAKE_CURRENT_SOURCE_DIR}/solver/.depend
                   WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/solver/)

add_custom_command(OUTPUT ${CMAKE_CURRENT_SOURCE_DIR}/solver/parser.cmx
                   COMMAND ${OCAMLOPT_EXECUTABLE}  ARGS -I +facile -c ${CMAKE_CURRENT_SOURCE_DIR}/solver/parser.ml
                   DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/solver/parser.cmi ${CMAKE_CURRENT_SOURCE_DIR}/solver/chemset.cmx
                   WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/solver/)

add_custom_command(OUTPUT ${CMAKE_CURRENT_SOURCE_DIR}/solver/lexer.cmx
                   COMMAND ${OCAMLOPT_EXECUTABLE}  ARGS -I +facile -c ${CMAKE_CURRENT_SOURCE_DIR}/solver/lexer.ml
                   DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/solver/chemset.cmx ${CMAKE_CURRENT_SOURCE_DIR}/solver/parser.cmx ${CMAKE_CURRENT_SOURCE_DIR}/solver/.depend
                   WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/solver/)


add_custom_command(OUTPUT ${CMAKE_CURRENT_SOURCE_DIR}/solver/calc.cmi
                   COMMAND ${OCAMLC_EXECUTABLE}  ARGS -I +facile -c ${CMAKE_CURRENT_SOURCE_DIR}/solver/calc.mli
                   DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/solver/chemset.cmi ${CMAKE_CURRENT_SOURCE_DIR}/solver/chemset.cmx ${CMAKE_CURRENT_SOURCE_DIR}/solver/.depend ${CMAKE_CURRENT_SOURCE_DIR}/solver/calc.mli ${CMAKE_CURRENT_SOURCE_DIR}/solver/datastruct.mli ${CMAKE_CURRENT_SOURCE_DIR}/solver/datastruct.cmx ${CMAKE_CURRENT_SOURCE_DIR}/solver/chem.cmx ${CMAKE_CURRENT_SOURCE_DIR}/solver/chem.mli ${CMAKE_CURRENT_SOURCE_DIR}/solver/parser.cmx ${CMAKE_CURRENT_SOURCE_DIR}/solver/parser.mli ${CMAKE_CURRENT_SOURCE_DIR}/solver/lexer.cmx
                   WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/solver)

add_custom_command(OUTPUT ${CMAKE_CURRENT_SOURCE_DIR}/solver/calc.cmx
                   COMMAND ${OCAMLOPT_EXECUTABLE}  ARGS -I +facile -c ${CMAKE_CURRENT_SOURCE_DIR}/solver/calc.ml
                   DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/solver/calc.cmi
                   WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/solver)



add_custom_command(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/solver/lexer.cmx
                   COMMAND ${OCAMLOPT_EXECUTABLE}  ARGS -I +facile -c lexer.ml
                   DEPENDS ${CMAKE_CURRENT_BINARY_DIR}/solver/parser.ml solver/lexer.ml
                   WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR})

add_custom_command(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/solver/modwrap.o
                   COMMAND ${OCAMLOPT_EXECUTABLE}  ARGS -I +facile -c modwrap.c
                   DEPENDS solver/modwrap.c
                   WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR})

add_custom_command(OUTPUT ${CMAKE_CURRENT_SOURCE_DIR}/solver/solver.o
                   COMMAND ${OCAMLOPT_EXECUTABLE}  ARGS -output-obj -o ${CMAKE_CURRENT_SOURCE_DIR}/solver/solver.o ${LIBFACILE_INCLUDE_DIR}/facile.cmxa  ${CMAKE_CURRENT_SOURCE_DIR}/solver/chemset.cmx ${CMAKE_CURRENT_SOURCE_DIR}/solver/parser.cmx ${CMAKE_CURRENT_SOURCE_DIR}/solver/lexer.cmx ${CMAKE_CURRENT_SOURCE_DIR}/solver/datastruct.cmx ${CMAKE_CURRENT_SOURCE_DIR}/solver/chem.cmx ${CMAKE_CURRENT_SOURCE_DIR}/solver/calc.cmx
                   DEPENDS ${LIBFACILE_INCLUDE_DIR}/facile.cmxa  ${CMAKE_CURRENT_SOURCE_DIR}/solver/chemset.cmx ${CMAKE_CURRENT_SOURCE_DIR}/solver/parser.cmx ${CMAKE_CURRENT_SOURCE_DIR}/solver/lexer.cmx ${CMAKE_CURRENT_SOURCE_DIR}/solver/datastruct.cmx ${CMAKE_CURRENT_SOURCE_DIR}/solver/chem.cmx ${CMAKE_CURRENT_SOURCE_DIR}/solver/calc.cmx
                   WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR})


if(KDE4_BUILD_TESTS)
add_custom_command(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/solver/main.cmx
                   COMMAND ${OCAMLOPT_EXECUTABLE}  ARGS -I +facile -c main.ml
                   DEPENDS solver/main.ml
                   WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR})

set(atestprog.opt_SRCS main.cmx ${CMAKE_CURRENT_BINARY_DIR}/chemset.cmx ${CMAKE_CURRENT_BINARY_DIR}/parser.cmx ${CMAKE_CURRENT_BINARY_DIR}/lexer.cmx ${CMAKE_CURRENT_BINARY_DIR}/datastruct.cmx ${CMAKE_CURRENT_BINARY_DIR}/chem.cmx ${CMAKE_CURRENT_BINARY_DIR}/calc.cmx  )

add_custom_command(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/solver/atestprog.opt
                   COMMAND ${OCAMLOPT_EXECUTABLE}  ARGS -o ${atestprog.opt_SRCS}
                   DEPENDS ${atestprog.opt_SRCS}
                   WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR})

	   #install( PROGRAMS atestprog.opt DESTINATION  ${BIN_INSTALL_DIR} )
endif(KDE4_BUILD_TESTS)
endif(LIBFACILE_FOUND)

